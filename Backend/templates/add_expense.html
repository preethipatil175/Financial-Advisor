<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Farmer Assistant - Budget Planner</title>
  </head>

  <body class="bg-green-50">
    <!-- ---------------- NAVBAR ADDED HERE ---------------- -->
    <nav
      class="flex justify-between items-center px-10 py-5 bg-white/80 backdrop-blur-xl shadow-lg sticky top-0 z-50 border-b border-gray-200"
    >
      <div class="flex items-center gap-3">
        <img src="/static/logo1.jpg" class="h-16 w-16 rounded-xl" />
        <h1
          id="title_main"
          class="text-2xl font-bold tracking-wide text-green-700"
        >
          Farmer Assistant
        </h1>
      </div>

      <div class="flex items-center gap-10">
        <a
          href="/"
          id="nav_home"
          class="font-semibold text-lg hover:text-green-700 transition"
        >
          Home
        </a>

        <!-- FEATURES -->
        <div class="relative">
          <button
            id="featuresBtn"
            class="font-semibold text-lg flex items-center gap-1 hover:text-green-700 transition"
          >
            <span id="nav_features">Features</span>
          </button>

          <div
            id="featuresMenu"
            class="absolute hidden flex-col bg-white shadow-2xl mt-4 rounded-xl p-4 w-64 border border-gray-200 right-0 space-y-2 z-50"
          >
            <a
              href="/financial-advice"
              id="features_financial"
              class="py-2 px-3 rounded hover:bg-green-100 transition font-medium"
              >Financial Advisor</a
            >
            <a
              href="/price-form"
              id="features_crop"
              class="py-2 px-3 rounded hover:bg-green-100 transition font-medium"
              >Crop Prediction</a
            >
            <a
              href="/loan-recommender"
              id="features_loan"
              class="py-2 px-3 rounded hover:bg-green-100 transition font-medium"
              >Loan Recommender</a
            >
            <a
              href="/expense-form"
              id="features_expense"
              class="py-2 px-3 rounded hover:bg-green-100 transition font-medium"
              >Expense Tracker</a
            >
            <a
              href="/budget-summary-page"
              class="py-2 px-3 rounded hover:bg-green-100 transition font-medium"
              id="features_budget"
            >
              Budget Summary
            </a>
          </div>
        </div>

        <!-- LANGUAGE -->
        <div class="relative">
          <button
            id="languageBtn"
            class="font-semibold text-lg flex items-center gap-1 hover:text-green-700 transition"
          >
            <span id="nav_language">Language</span>
          </button>

          <div
            id="languageMenu"
            class="absolute hidden flex-col bg-white shadow-2xl mt-4 rounded-xl p-4 w-40 border border-gray-200 right-0 space-y-2 z-50"
          >
            <button
              onclick="loadLanguage('en')"
              class="py-2 px-3 rounded hover:bg-green-100 transition"
            >
              English
            </button>
            <button
              onclick="loadLanguage('kn')"
              class="py-2 px-3 rounded hover:bg-green-100 transition"
            >
              ಕನ್ನಡ
            </button>
          </div>
        </div>

        <button>
          <img
            src="/static/login_icon.png"
            class="h-10 w-10 hover:scale-110 transition"
          />
        </button>
      </div>
    </nav>

    <!-- ---------------- BUDGET PLANNER ---------------- -->

    <div class="max-w-3xl mx-auto mt-10 bg-white p-8 rounded-xl shadow-lg">
      <h1 id="titleText" class="text-3xl font-bold text-green-800 mb-6"></h1>

      <label id="budgetLabel" class="font-semibold"></label>
      <input
        id="budgetInput"
        type="number"
        class="w-full p-2 border rounded mt-2 mb-4"
      />

      <button
        id="setBudgetBtn"
        onclick="setBudget()"
        class="bg-green-600 text-white px-6 py-2 rounded"
      >
        Set Budget
      </button>

      <h2
        id="expenseTitle"
        class="text-2xl font-bold text-green-700 mt-10"
      ></h2>

      <label id="amountLabel" class="font-semibold"></label>
      <input
        id="expenseAmount"
        type="number"
        class="w-full p-2 border rounded mt-2 mb-4"
      />

      <label id="categoryLabel" class="font-semibold"></label>
      <select
        id="categorySelect"
        class="w-full p-2 border rounded mt-2 mb-4"
      ></select>

      <label id="descriptionLabel" class="font-semibold"></label>
      <input
        id="expenseDescription"
        class="w-full p-2 border rounded mt-2 mb-4"
      />

      <button
        id="addExpenseBtn"
        onclick="addExpense()"
        class="bg-green-600 text-white px-6 py-2 rounded"
      >
        Add Expense
      </button>

      <h2
        id="summaryTitle"
        class="text-2xl font-bold text-green-700 mt-10"
      ></h2>

      <p id="budgetSummary" class="font-semibold"></p>
      <p id="expenseSummary" class="font-semibold mb-4"></p>

      <h3
        id="expenseListTitle"
        class="text-xl font-bold text-green-700 mt-5"
      ></h3>

      <ul id="expenseList" class="list-disc pl-5"></ul>

      <canvas id="pieChart" class="mt-10"></canvas>
    </div>

    <script>
      let budget = 0;
      let expenses = [];

      const categoryOptions = {
        en: [
          "Seeds & Planting",
          "Equipment & Machinery",
          "Irrigation & Water",
          "Fertilizers",
          "Pesticides & Chemicals",
          "Labor Costs",
          "Transportation",
          "Market & Selling",
          "Food & Personal",
          "Household",
          "Fuel & Energy",
          "Veterinary & Livestock",
          "Maintenance & Repairs",
          "Loan & Interest",
          "Communication",
          "Miscellaneous",
        ],
        kn: [
          "ಬೀಜಗಳು ಮತ್ತು ನೆಡುವಿಕೆ",
          "ಉಪಕರಣಗಳು ಮತ್ತು ಯಂತ್ರೋಪಕರಣಗಳು",
          "ನೀರಾವರಿ ಮತ್ತು ನೀರು",
          "ರಸಗೊಬ್ಬರಗಳು",
          "ಕೀಟನಾಶಕಗಳು ಮತ್ತು ರಾಸಾಯನಿಕಗಳು",
          "ಕಾರ್ಮಿಕ ವೆಚ್ಚ",
          "ಸಾರಿಗೆ",
          "ಮಾರಾಟ ಮತ್ತು ಮಾರುಕಟ್ಟೆ",
          "ಆಹಾರ ಮತ್ತು ವೈಯಕ್ತಿಕ",
          "ಗೃಹ ಬಳಕೆ",
          "ಇಂಧನ ಮತ್ತು ಶಕ್ತಿ",
          "ಪಶುವೈದ್ಯಕೀಯ ಮತ್ತು ಪಶುಸಂಗೋಪನೆ",
          "ನಿರ್ವಹಣೆ ಮತ್ತು ದುರಸ್ತಿ",
          "ಸಾಲ ಮತ್ತು ಬಡ್ಡಿ",
          "ಸಂಪರ್ಕ",
          "ಇತರೆ",
        ],
      };

      const uiText = {
        en: {
          nav_home: "Home",
          nav_features: "Features",
          nav_language: "Language",
          features_financial: "Financial Advisor",
          features_crop: "Crop Prediction",
          features_loan: "Loan Recommender",
          features_expense: "Expense Tracker",
          features_budget: "Budget Summary",

          title: "Budget Planner",
          budgetLabel: "Enter Monthly Budget",
          setBudgetBtn: "Set Budget",
          expenseTitle: "Add Expense",
          amountLabel: "Amount",
          categoryLabel: "Category",
          descriptionLabel: "Description",
          addExpenseBtn: "Add Expense",
          summaryTitle: "Summary",
          expenseListTitle: "All Expenses",
          budgetSummary: (amt) => `Total Budget: ₹${amt}`,
          expenseSummary: (amt) => `Total Expenses: ₹${amt}`,
        },
        kn: {
          nav_home: "ಮುಖಪುಟ",
          nav_features: "ವೈಶಿಷ್ಟ್ಯಗಳು",
          nav_language: "ಭಾಷೆ",
          features_financial: "ಹಣಕಾಸು ಸಲಹೆಗಾರ",
          features_crop: "ಬೆಳೆ ಭವಿಷ್ಯವಾಣಿ",
          features_loan: "ಸಾಲ ಶಿಫಾರಸು",
          features_expense: "ವೆಚ್ಚ ಟ್ರ್ಯಾಕರ್",
          features_budget: "ಬಜೆಟ್ ಸಾರಾಂಶ",

          title: "ಬಜೆಟ್ ಪ್ಲ್ಯಾನರ್",
          budgetLabel: "ತಿಂಗಳ ಬಜೆಟ್ ನಮೂದಿಸಿ",
          setBudgetBtn: "ಬಜೆಟ್ ಸೆಟ್ ಮಾಡಿ",
          expenseTitle: "ಖರ್ಚು ಸೇರಿಸಿ",
          amountLabel: "ಮೊತ್ತ",
          categoryLabel: "ವರ್ಗ",
          descriptionLabel: "ವಿವರಣೆ",
          addExpenseBtn: "ಖರ್ಚು ಸೇರಿಸಿ",
          summaryTitle: "ಸಾರಾಂಶ",
          expenseListTitle: "ಎಲ್ಲಾ ಖರ್ಚುಗಳು",
          budgetSummary: (amt) => `ಒಟ್ಟು ಬಜೆಟ್: ₹${amt}`,
          expenseSummary: (amt) => `ಒಟ್ಟು ಖರ್ಚುಗಳು: ₹${amt}`,
        },
      };

      function loadLanguage(lang) {
        const t = uiText[lang];

        document.getElementById("nav_home").innerText = t.nav_home;
        document.getElementById("nav_features").innerText = t.nav_features;
        document.getElementById("nav_language").innerText = t.nav_language;

        document.getElementById("features_financial").innerText =
          t.features_financial;
        document.getElementById("features_crop").innerText = t.features_crop;
        document.getElementById("features_loan").innerText = t.features_loan;
        document.getElementById("features_expense").innerText =
          t.features_expense;
        document.getElementById("features_budget").innerText =
          t.features_budget;

        document.getElementById("titleText").innerText = t.title;
        document.getElementById("budgetLabel").innerText = t.budgetLabel;
        document.getElementById("setBudgetBtn").innerText = t.setBudgetBtn;
        document.getElementById("expenseTitle").innerText = t.expenseTitle;
        document.getElementById("amountLabel").innerText = t.amountLabel;
        document.getElementById("categoryLabel").innerText = t.categoryLabel;
        document.getElementById("descriptionLabel").innerText =
          t.descriptionLabel;
        document.getElementById("addExpenseBtn").innerText = t.addExpenseBtn;
        document.getElementById("summaryTitle").innerText = t.summaryTitle;
        document.getElementById("expenseListTitle").innerText =
          t.expenseListTitle;

        updateSummary();
        loadCategories(lang);
      }

      function loadCategories(lang) {
        const select = document.getElementById("categorySelect");
        select.innerHTML = "";

        categoryOptions[lang].forEach((cat) => {
          const op = document.createElement("option");
          op.value = cat;
          op.innerText = cat;
          select.appendChild(op);
        });
      }

      function setBudget() {
        budget = Number(document.getElementById("budgetInput").value);
        updateSummary();
      }

      function addExpense() {
        const amount = Number(document.getElementById("expenseAmount").value);
        const category = document.getElementById("categorySelect").value;
        const description = document.getElementById("expenseDescription").value;

        if (!amount) return alert("Enter amount");

        expenses.push({ amount, category, description });
        updateExpenseList();
        updateSummary();
        drawPieChart();
      }

      function updateExpenseList() {
        const list = document.getElementById("expenseList");
        list.innerHTML = "";
        expenses.forEach((e) => {
          const li = document.createElement("li");
          li.innerText = `${e.category} - ₹${e.amount} (${e.description})`;
          list.appendChild(li);
        });
      }

      function updateSummary() {
        const lang =
          document.getElementById("nav_language").innerText === "ಭಾಷೆ"
            ? "kn"
            : "en";
        const t = uiText[lang];
        const total = expenses.reduce((s, e) => s + e.amount, 0);

        document.getElementById("budgetSummary").innerText =
          t.budgetSummary(budget);
        document.getElementById("expenseSummary").innerText =
          t.expenseSummary(total);
      }

      let chart = null;
      function drawPieChart() {
        const ctx = document.getElementById("pieChart");
        const data = {};

        expenses.forEach((e) => {
          data[e.category] = (data[e.category] || 0) + e.amount;
        });

        if (chart) chart.destroy();

        chart = new Chart(ctx, {
          type: "pie",
          data: {
            labels: Object.keys(data),
            datasets: [{ data: Object.values(data) }],
          },
        });
      }

      // default load
      loadLanguage("en");
    </script>
  </body>
</html>
