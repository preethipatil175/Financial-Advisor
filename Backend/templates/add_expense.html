<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Expense Tracker ‚Äî Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        background: linear-gradient(to right, #e6f9e6, #c8f2c8);
      }
      #featuresMenu a { display: block; }
    </style>
  </head>

  <body class="min-h-screen">
    <!-- NAVBAR -->
    <nav class="flex justify-between items-center px-5 py-4 bg-white/80 backdrop-blur-xl shadow-lg sticky top-0 z-50 border-b border-gray-200">
      <div class="flex items-center gap-3">
        <img src="/static/logo1.jpg" class="h-14 w-14 rounded-xl" />
        <h1 id="nav_title" class="text-2xl font-bold tracking-wide text-green-700">Expense Tracker</h1>
      </div>

      <div class="flex items-center gap-6">
        <a id="nav_home" href="/" class="font-semibold text-lg hover:text-green-700 transition">Home</a>

        <!-- FEATURES -->
        <div class="relative">
          <button id="featuresBtn" class="font-semibold text-lg hover:text-green-700 transition">
            <span id="nav_features">Features</span>
          </button>
          <div id="featuresMenu" class="absolute hidden right-0 mt-3 bg-white rounded-xl shadow-xl p-4 w-64 border border-gray-200 space-y-2 z-50">
            <a href="/financial-advice-page" id="features_financial" class="py-2 px-3 rounded hover:bg-green-100 transition font-medium">Financial Advisor</a>
            <a href="/price-form" id="features_crop" class="py-2 px-3 rounded hover:bg-green-100 transition font-medium">Crop Prediction</a>
            <a href="/loan-recommender" id="features_loan" class="py-2 px-3 rounded hover:bg-green-100 transition font-medium">Loan Recommender</a>
            <a href="/expense-form" id="features_expense" class="py-2 px-3 rounded hover:bg-green-100 transition font-medium">Expense Tracker</a>
            <a href="/budget-summary-page" id="features_budget" class="py-2 px-3 rounded hover:bg-green-100 transition font-medium">Budget Summary</a>
          </div>
        </div>

        <!-- LANGUAGE -->
        <div class="relative">
          <button id="languageBtn" class="font-semibold text-lg hover:text-green-700 transition">
            <span id="nav_language">Language</span>
          </button>
          <div id="languageMenu" class="absolute hidden right-0 mt-3 bg-white rounded-xl shadow-xl p-3 w-40 border border-gray-200 z-50 space-y-2">
            <button onclick="setLanguage('en')" class="py-2 px-3 rounded hover:bg-green-100 transition w-full text-left">English</button>
            <button onclick="setLanguage('kn')" class="py-2 px-3 rounded hover:bg-green-100 transition w-full text-left">‡≤ï‡≤®‡≥ç‡≤®‡≤°</button>
          </div>
        </div>

        <button>
          <img src="/static/login_icon.png" class="h-10 w-10 hover:scale-110 transition" />
        </button>
      </div>
    </nav>

    <!-- MAIN GRID (20px padding = p-5) -->
    <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 p-5 max-w-7xl mx-auto">
      <!-- LEFT: Form + Recent (col-span 3) -->
      <div class="lg:col-span-3 bg-white rounded-2xl shadow-xl p-6 border border-green-200">
        <h2 id="form_title" class="text-2xl font-bold text-green-700 mb-4 text-center">Add New Expense</h2>

        <!-- Dynamic form uses JS API (/update-expense) -->
        <form id="expenseForm" class="space-y-4">
          <div>
            <label id="label_name" class="block text-gray-700 font-semibold">Expense Name:</label>
            <input id="inp_name" type="text" required class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-green-500" />
          </div>

          <div>
            <label id="label_amount" class="block text-gray-700 font-semibold">Amount (‚Çπ):</label>
            <input id="inp_amount" type="number" step="0.01" required class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-green-500" />
          </div>

          <div>
            <label id="label_category" class="block text-gray-700 font-semibold">Category:</label>

            <!-- categories rendered server-side with English values; JS will translate labels on language change -->
            <select id="sel_category" required class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-green-500">
              {% for c in categories %}
                <option value="{{ c|e }}" data-eng="{{ c|e }}">{{ c|e }}</option>
              {% endfor %}
            </select>
          </div>

          <div>
            <label id="label_date" class="block text-gray-700 font-semibold">Date:</label>
            <input id="inp_date" type="date" class="w-full border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-green-500" />
          </div>

          <div>
            <button id="btn_save" type="submit" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 transition">
              Save Expense
            </button>
          </div>
        </form>

        <div id="apiMessage" class="mt-4"></div>

        <!-- RECENT EXPENSES -->
        <h3 id="recent_title" class="mt-6 mb-3 text-lg font-semibold text-green-700">Recently Added</h3>
        <ul id="recent_list" class="space-y-3">
          {% if recent_expenses %}
            {% for exp in recent_expenses %}
              <li class="border-b border-gray-200 pb-2 flex justify-between items-center" data-name="{{ exp.name }}" data-category="{{ exp.category }}" data-amount="{{ exp.amount }}" data-date="{{ exp.date }}">
                <div>
                  <p class="font-semibold text-gray-800 name_display">{{ exp.name }}</p>
                  <p class="text-sm text-gray-500 category_display"></p>
                </div>
                <form action="/delete-expense/{{ loop.index0 }}" method="POST" class="ml-4">
                  <button type="submit" class="text-red-500 hover:text-red-700 text-sm font-medium delete-btn">Delete</button>
                </form>
              </li>
            {% endfor %}
          {% else %}
            <p class="text-gray-500">No expenses yet.</p>
          {% endif %}
        </ul>
      </div>

      <!-- RIGHT: Budget + Chart (col-span 2) -->
      <div class="lg:col-span-2 bg-white rounded-2xl shadow-xl p-6 border border-green-200 flex flex-col">
        <h2 id="budget_title" class="text-2xl font-bold text-green-700 mb-4 text-center">Set Your Monthly Budget</h2>

        <label id="label_budget" class="font-semibold">Enter Budget Amount (‚Çπ):</label>
        <input id="budgetInput" type="number" min="0" class="w-full p-3 border rounded-xl mt-2 mb-4" />

        <button id="saveBudgetBtn" class="bg-green-600 text-white px-6 py-3 rounded-xl hover:bg-green-700 transition w-full">Save Budget</button>

        <p id="budgetMsg" class="mt-3 text-green-700 font-semibold"></p>

        <hr class="my-4" />

        <h3 id="chart_title" class="text-xl font-bold text-green-700 mb-4">Monthly Expense Breakdown</h3>
        <canvas id="expenseChart" class="w-full h-64"></canvas>

        <div id="budgetStats" class="mt-4 text-gray-700"></div>
      </div>
    </div>

    <script>
      /************************************************************************
       * TRANSLATIONS & CATEGORY MAP (final Kannada translations you approved)
       ************************************************************************/
      const TRANSLATIONS = {
        en: {
          nav_title: "Expense Tracker", home: "Home", features: "Features", language: "Language",
          features_financial: "Financial Advisor", features_crop: "Crop Prediction", features_loan: "Loan Recommender",
          features_expense: "Expense Tracker", features_budget: "Budget Summary",
          form_title: "Add New Expense", label_name: "Expense Name:", label_amount: "Amount (‚Çπ):",
          label_category: "Category:", label_date: "Date:", btn_save: "Save Expense", recent_title: "Recently Added",
          budget_title: "Set Your Monthly Budget", label_budget: "Enter Budget Amount (‚Çπ):", save_budget_btn: "Save Budget",
          chart_title: "Monthly Expense Breakdown",
          budget_stats: { total_budget: "Total Budget", total_spent: "Total Spent", remaining: "Remaining" },
          messages: { add_success: "Expense added successfully!", budget_saved: "Budget updated successfully!" }
        },
        kn: {
          nav_title: "‡≤ñ‡≤∞‡≥ç‡≤ö‡≥Å ‡≤ü‡≥ç‡≤∞‡≥ç‡≤Ø‡≤æ‡≤ï‡≤∞‡≥ç", home: "‡≤Æ‡≥Å‡≤ñ‡≤™‡≥Å‡≤ü", features: "‡≤µ‡≥à‡≤∂‡≤ø‡≤∑‡≥ç‡≤ü‡≥ç‡≤Ø‡≤ó‡≤≥‡≥Å", language: "‡≤≠‡≤æ‡≤∑‡≥Ü",
          features_financial: "‡≤Ü‡≤∞‡≥ç‡≤•‡≤ø‡≤ï ‡≤∏‡≤≤‡≤π‡≥Ü‡≤ó‡≤æ‡≤∞", features_crop: "‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤≠‡≤µ‡≤ø‡≤∑‡≥ç‡≤Ø‡≤µ‡≤æ‡≤£‡≤ø", features_loan: "‡≤∏‡≤æ‡≤≤ ‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥Å",
          features_expense: "‡≤ñ‡≤∞‡≥ç‡≤ö‡≥Å ‡≤ü‡≥ç‡≤∞‡≥ç‡≤Ø‡≤æ‡≤ï‡≤∞‡≥ç", features_budget: "‡≤¨‡≤ú‡≥Ü‡≤ü‡≥ç ‡≤∏‡≤æ‡≤∞‡≤æ‡≤Ç‡≤∂",
          form_title: "‡≤π‡≥ä‡≤∏ ‡≤ñ‡≤∞‡≥ç‡≤ö‡≥Å ‡≤∏‡≥á‡≤∞‡≤ø‡≤∏‡≤ø", label_name: "‡≤ñ‡≤∞‡≥ç‡≤ö‡≤ø‡≤® ‡≤π‡≥Ü‡≤∏‡≤∞‡≥Å:", label_amount: "‡≤∞‡≤æ‡≤∂‡≤ø (‚Çπ):",
          label_category: "‡≤µ‡≤∞‡≥ç‡≤ó:", label_date: "‡≤¶‡≤ø‡≤®‡≤æ‡≤Ç‡≤ï:", btn_save: "‡≤ñ‡≤∞‡≥ç‡≤ö‡≥Å ‡≤â‡≤≥‡≤ø‡≤∏‡≤ø", recent_title: "‡≤á‡≤§‡≥ç‡≤§‡≥Ä‡≤ö‡≥Ü‡≤ó‡≥Ü ‡≤∏‡≥á‡≤∞‡≤ø‡≤∏‡≤ø‡≤¶‡≤µ‡≥Å",
          budget_title: "‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤Æ‡≤æ‡≤∏‡≤ø‡≤ï ‡≤¨‡≤ú‡≥Ü‡≤ü‡≥ç ‡≤∏‡≥Ü‡≤ü‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø", label_budget: "‡≤¨‡≤ú‡≥Ü‡≤ü‡≥ç ‡≤Æ‡≥ä‡≤§‡≥ç‡≤§ (‚Çπ) ‡≤®‡≤Æ‡≥Ç‡≤¶‡≤ø‡≤∏‡≤ø:", save_budget_btn: "‡≤¨‡≤ú‡≥Ü‡≤ü‡≥ç ‡≤â‡≤≥‡≤ø‡≤∏‡≤ø",
          chart_title: "‡≤Æ‡≤æ‡≤∏‡≤ø‡≤ï ‡≤ñ‡≤∞‡≥ç‡≤ö‡≥Å ‡≤µ‡≤ø‡≤≠‡≤æ‡≤ó‡≥Ä‡≤ï‡≤∞‡≤£",
          budget_stats: { total_budget: "‡≤í‡≤ü‡≥ç‡≤ü‡≥Å ‡≤¨‡≤ú‡≥Ü‡≤ü‡≥ç", total_spent: "‡≤í‡≤ü‡≥ç‡≤ü‡≥Å ‡≤ñ‡≤∞‡≥ç‡≤ö‡≥Å", remaining: "‡≤â‡≤≥‡≤ø‡≤¶‡≤ø‡≤¶‡≥Ü" },
          messages: { add_success: "‡≤ñ‡≤∞‡≥ç‡≤ö‡≥Å ‡≤Ø‡≤∂‡≤∏‡≥ç‡≤µ‡≤ø‡≤Ø‡≤æ‡≤ó‡≤ø ‡≤∏‡≥á‡≤∞‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü!", budget_saved: "‡≤¨‡≤ú‡≥Ü‡≤ü‡≥ç ‡≤Ø‡≤∂‡≤∏‡≥ç‡≤µ‡≤ø‡≤Ø‡≤æ‡≤ó‡≤ø ‡≤®‡≤µ‡≥Ä‡≤ï‡≤∞‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü!" }
        }
      };

      // Accurate Kannada translations (from your finalized list)
      const CATEGORY_MAP = {
        "Seeds & Planting": "‡≤¨‡≥Ä‡≤ú‡≤ó‡≤≥‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤®‡≥Ü‡≤°‡≥Å‡≤µ‡≥Å‡≤¶‡≥Å",
        "Equipment & Machinery": "‡≤â‡≤™‡≤ï‡≤∞‡≤£‡≤ó‡≤≥‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Ø‡≤Ç‡≤§‡≥ç‡≤∞‡≥ã‡≤™‡≤ï‡≤∞‡≤£‡≤ó‡≤≥‡≥Å",
        "Irrigation & Water": "‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤®‡≥Ä‡≤∞‡≥Å",
        "Fertilizers": "‡≤∞‡≤∏‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞",
        "Pesticides & Chemicals": "‡≤ï‡≥Ä‡≤ü‡≤®‡≤æ‡≤∂‡≤ï‡≤ó‡≤≥‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤∞‡≤æ‡≤∏‡≤æ‡≤Ø‡≤®‡≤ø‡≤ï‡≤ó‡≤≥‡≥Å",
        "Labor Costs": "‡≤ï‡≤æ‡≤∞‡≥ç‡≤Æ‡≤ø‡≤ï ‡≤µ‡≥Ü‡≤ö‡≥ç‡≤ö",
        "Transportation": "‡≤∏‡≤æ‡≤∞‡≤ø(‡≤ó‡≥Ü)",           // short natural Kannada
        "Market & Selling": "‡≤Æ‡≤æ‡≤∞‡≥Å‡≤ï‡≤ü‡≥ç‡≤ü‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Æ‡≤æ‡≤∞‡≤æ‡≤ü",
        "Food & Personal": "‡≤Ü‡≤π‡≤æ‡≤∞ ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤µ‡≥à‡≤Ø‡≤ï‡≥ç‡≤§‡≤ø‡≤ï",
        "Household": "‡≤ó‡≥É‡≤π‡≥ã‡≤™‡≤Ø‡≥ã‡≤ó‡≤ø",
        "Fuel & Energy": "‡≤á‡≤Ç‡≤ß‡≤® ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤µ‡≤ø‡≤¶‡≥ç‡≤Ø‡≥Å‡≤§‡≥ç",
        "Veterinary & Livestock": "‡≤™‡≤∂‡≥Å‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤™‡≤∂‡≥Å‡≤∏‡≤Ç‡≤ó‡≥ã‡≤™‡≤®‡≥Ü",
        "Maintenance & Repairs": "‡≤®‡≤ø‡≤∞‡≥ç‡≤µ‡≤π‡≤£‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤¶‡≥Å‡≤∞‡≤∏‡≥ç‡≤§‡≤ø",
        "Loan & Interest": "‡≤∏‡≤æ‡≤≤ ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤¨‡≤°‡≥ç‡≤°‡≤ø",
        "Communication": "‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï",
        "Miscellaneous": "‡≤á‡≤§‡≤∞‡≥Ü"
      };

      // Utility
      function el(id){ return document.getElementById(id); }
      let currentLang = localStorage.getItem("lang") || "en";

      function setLanguage(lang){
        currentLang = lang;
        localStorage.setItem("lang", lang);
        applyTranslations();
      }

      function applyTranslations(){
        const t = TRANSLATIONS[currentLang] || TRANSLATIONS.en;
        // navbar + features
        if(el("nav_title")) el("nav_title").innerText = t.nav_title;
        if(el("nav_home")) el("nav_home").innerText = t.home;
        if(el("nav_features")) el("nav_features").innerText = t.features;
        if(el("nav_language")) el("nav_language").innerText = t.language;
        if(el("features_financial")) el("features_financial").innerText = t.features_financial;
        if(el("features_crop")) el("features_crop").innerText = t.features_crop;
        if(el("features_loan")) el("features_loan").innerText = t.features_loan;
        if(el("features_expense")) el("features_expense").innerText = t.features_expense;
        if(el("features_budget")) el("features_budget").innerText = t.features_budget;

        // form UI
        if(el("form_title")) el("form_title").innerText = t.form_title;
        if(el("label_name")) el("label_name").innerText = t.label_name;
        if(el("label_amount")) el("label_amount").innerText = t.label_amount;
        if(el("label_category")) el("label_category").innerText = t.label_category;
        if(el("label_date")) el("label_date").innerText = t.label_date;
        if(el("btn_save")) el("btn_save").innerText = t.btn_save;
        if(el("recent_title")) el("recent_title").innerText = t.recent_title;

        // budget side
        if(el("budget_title")) el("budget_title").innerText = t.budget_title;
        if(el("label_budget")) el("label_budget").innerText = t.label_budget;
        if(el("saveBudgetBtn")) el("saveBudgetBtn").innerText = t.save_budget_btn || t.save_budget_btn;
        if(el("chart_title")) el("chart_title").innerText = t.chart_title;

        // categories & recent entries
        translateCategoryOptions();
        translateRecentList();

        // update chart texts/stats
        loadChart();
      }

      function translateCategoryOptions(){
        const sel = el("sel_category");
        if(!sel) return;
        Array.from(sel.options).forEach(opt=>{
          const eng = opt.getAttribute("data-eng") || opt.value;
          opt.textContent = (currentLang === "kn") ? (CATEGORY_MAP[eng] || eng) : eng;
        });
      }

      function translateRecentList(){
        const items = document.querySelectorAll("#recent_list li");
        items.forEach(li=>{
          const engCat = li.getAttribute("data-category");
          const catElem = li.querySelector(".category_display");
          const nameElem = li.querySelector(".name_display");
          const amt = li.getAttribute("data-amount");
          const date = li.getAttribute("data-date");
          if(nameElem) nameElem.innerText = li.getAttribute("data-name") || "";
          if(catElem){
            if(currentLang === "kn") catElem.innerText = `${CATEGORY_MAP[engCat] || engCat} ‚Äî ‚Çπ${amt} ‚Ä¢ ${date}`;
            else catElem.innerText = `${engCat} ‚Äî ‚Çπ${amt} ‚Ä¢ ${date}`;
          }
        });
      }

      // Add expense (AJAX)
      if(el("expenseForm")){
        el("expenseForm").addEventListener("submit", async (e)=>{
          e.preventDefault();
          const name = el("inp_name").value.trim();
          const amount = el("inp_amount").value.trim();
          const category = el("sel_category").value;
          const date = el("inp_date").value || new Date().toISOString().slice(0,10);
          if(!name || !amount || !category){ showMessage("Please fill all required fields","red"); return; }
          try{
            const res = await fetch("/update-expense",{ method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({ name, category, amount, date }) });
            const data = await res.json();
            showMessage(TRANSLATIONS[currentLang].messages.add_success,"green");
            prependRecent({ name, category, amount, date });
            el("inp_name").value=""; el("inp_amount").value=""; el("inp_date").value="";
            loadChart();
          }catch(err){ console.error(err); showMessage("Error adding expense","red"); }
        });
      }

      function prependRecent(exp){
        const ul = el("recent_list");
        if(!ul) return;
        const li = document.createElement("li");
        li.className = "border-b border-gray-200 pb-2 flex justify-between items-center";
        li.setAttribute("data-name", exp.name);
        li.setAttribute("data-category", exp.category);
        li.setAttribute("data-amount", exp.amount);
        li.setAttribute("data-date", exp.date);
        li.innerHTML = `
          <div>
            <p class="font-semibold text-gray-800 name_display">${exp.name}</p>
            <p class="text-sm text-gray-500 category_display"></p>
          </div>
          <form action="/delete-expense/0" method="POST" class="ml-4">
            <button type="submit" class="text-red-500 hover:text-red-700 text-sm font-medium delete-btn">Delete</button>
          </form>
        `;
        ul.insertBefore(li, ul.firstChild);
        translateRecentList();
      }

      function showMessage(msg, color="green"){
        const div = el("apiMessage");
        if(!div) return;
        div.innerHTML = `<div class="p-3 rounded ${color==='green'?'bg-green-100 text-green-800':'bg-red-100 text-red-800'}">${msg}</div>`;
        setTimeout(()=> div.innerHTML = "", 3000);
      }

      // Save budget
      if(el("saveBudgetBtn")){
        el("saveBudgetBtn").addEventListener("click", async ()=>{
          const amount = el("budgetInput").value || 0;
          try{
            const res = await fetch("/set-budget",{ method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({ amount }) });
            const data = await res.json();
            showMessage(TRANSLATIONS[currentLang].messages.budget_saved,"green");
            loadChart();
          }catch(err){ console.error(err); showMessage("Failed to save budget","red"); }
        });
      }

      // Chart
      let chartRef = null;
      async function loadChart(){
        try{
          const res = await fetch("/expense-chart-data");
          const data = await res.json();
          const labels = (data.labels || []).map(l => currentLang === "kn" ? (CATEGORY_MAP[l] || l) : l);
          const ctx = document.getElementById("expenseChart").getContext("2d");
          if(chartRef) chartRef.destroy();
          chartRef = new Chart(ctx, {
            type: "pie",
            data: {
              labels: labels.map((l,i) => `${l} (${data.percentages && data.percentages[i] ? data.percentages[i].toFixed(1) : 0}%)`),
              datasets: [{ data: data.values || [], borderWidth: 1 }]
            },
            options: { responsive: true, plugins: { legend: { position: "bottom" } } }
          });
          // budget stats
          const bs = TRANSLATIONS[currentLang].budget_stats;
          el("budgetStats").innerHTML = `
            <p>üí∞ <b>${bs.total_budget}:</b> ‚Çπ${data.budget || 0}</p>
            <p>üìâ <b>${bs.total_spent}:</b> ‚Çπ${data.total_spent || 0}</p>
            <p>üü¢ <b>${bs.remaining}:</b> ‚Çπ${data.remaining || 0}</p>
          `;
        }catch(err){ console.error("Failed to load chart",err); }
      }

      // initial setup
      document.getElementById("featuresBtn").onclick = ()=> document.getElementById("featuresMenu").classList.toggle("hidden");
      document.getElementById("languageBtn").onclick = ()=> document.getElementById("languageMenu").classList.toggle("hidden");

      // apply language & load chart
      setLanguage(currentLang);
      loadChart();
      // refresh periodically
      setInterval(loadChart, 5000);
    </script>
  </body>
</html>
