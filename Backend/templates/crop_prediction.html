<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crop Price Prediction | Farmer Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        background: #f9fafb;
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>

  <body class="min-h-screen flex flex-col">
    <!-- ✅ NAVBAR -->
    <nav
      class="flex justify-between items-center px-10 py-5 bg-white/80 backdrop-blur-xl shadow-lg sticky top-0 z-50 border-b border-gray-200"
    >
      <!-- Logo -->
      <div class="flex items-center gap-3">
        <img src="/static/logo1.jpg" class="h-16 w-16 rounded-xl" />
        <h1 class="text-2xl font-bold tracking-wide text-green-700">
          Farmer Assistant
        </h1>
      </div>

      <div class="flex items-center gap-10">
        <!-- ✅ FEATURES DROPDOWN -->
        <div class="relative">
          <button
            id="featuresBtn"
            class="font-semibold text-lg flex items-center gap-1 hover:text-green-700 transition"
          >
            Features
          </button>
          <div
            id="featuresMenu"
            class="absolute hidden flex-col bg-white shadow-2xl mt-4 rounded-xl p-4 w-64 border border-gray-200 right-0 space-y-2 z-50"
          >
            <a
              href="/financial-advice-page"
              class="py-2 px-3 rounded hover:bg-green-100 transition font-medium"
              >Financial Advisor</a
            >
            <a
              href="/price-form"
              class="py-2 px-3 rounded hover:bg-green-100 transition font-medium"
              >Crop Prediction</a
            >
            <a
              href="/loan-recommender"
              class="py-2 px-3 rounded hover:bg-green-100 transition font-medium"
              >Loan Recommender</a
            >
            <a
              href="/expense-form"
              class="py-2 px-3 rounded hover:bg-green-100 transition font-medium"
              >Expense Tracker</a
            >
            <a
              href="/budget-summary-page"
              class="py-2 px-3 rounded hover:bg-green-100 transition font-medium"
              >Budget Summary</a
            >
          </div>
        </div>

        <!-- ✅ LANGUAGE DROPDOWN -->
        <div class="relative">
          <button
            id="languageBtn"
            class="font-semibold text-lg flex items-center gap-1 hover:text-green-700 transition"
          >
            Language
          </button>
          <div
            id="languageMenu"
            class="absolute hidden flex-col bg-white shadow-2xl mt-4 rounded-xl p-4 w-40 border border-gray-200 right-0 space-y-2 z-50"
          >
            <button class="py-2 px-3 rounded hover:bg-green-100 transition">
              English
            </button>
            <button class="py-2 px-3 rounded hover:bg-green-100 transition">
              Kannada
            </button>
          </div>
        </div>

        <!-- ✅ LOGIN ICON -->
        <button>
          <img
            src="/static/login_icon.png"
            class="h-10 w-10 hover:scale-110 transition"
          />
        </button>
      </div>
    </nav>

    <!-- ✅ MAIN CONTENT -->
    <main
      class="flex flex-col md:flex-row justify-center items-center gap-10 px-10 py-10 flex-1"
    >
      <!-- FORM SECTION -->
      <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-md">
        <h2 class="text-2xl font-bold text-green-700 mb-6 text-center">
          Crop Price Prediction
        </h2>
        <form id="predictionForm" class="space-y-5">
          <div>
            <label class="block font-medium mb-2">Select Crop</label>
            <select
              id="crop"
              name="crop"
              class="w-full border border-gray-300 rounded-lg p-3 focus:ring focus:ring-green-300"
              required
            >
              <option value="jowar">Jowar</option>
              <option value="wheat">Wheat</option>
              <option value="cotton">Cotton</option>
              <option value="sugarcane">Sugarcane</option>
              <option value="bajara">Bajara</option>
            </select>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block font-medium mb-2">Month</label>
              <input
                type="number"
                id="month"
                name="month"
                min="1"
                max="12"
                class="w-full border border-gray-300 rounded-lg p-3 focus:ring focus:ring-green-300"
                required
              />
            </div>
            <div>
              <label class="block font-medium mb-2">Year</label>
              <input
                type="number"
                id="year"
                name="year"
                min="2020"
                class="w-full border border-gray-300 rounded-lg p-3 focus:ring focus:ring-green-300"
                required
              />
            </div>
          </div>

          <div>
            <label class="block font-medium mb-2">Rainfall (mm)</label>
            <input
              type="number"
              id="rainfall"
              name="rainfall"
              step="0.1"
              class="w-full border border-gray-300 rounded-lg p-3 focus:ring focus:ring-green-300"
              required
            />
          </div>

          <button
            type="submit"
            class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg py-3 transition"
          >
            Predict Price
          </button>
        </form>
      </div>

      <!-- GRAPH SECTION -->
      <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-2xl">
        <h2 class="text-2xl font-bold text-green-700 text-center mb-4">
          Prediction Results
        </h2>

        <div id="result" class="hidden text-center mb-4">
          <p
            id="priceRange"
            class="text-lg font-semibold text-gray-700 mb-1"
          ></p>
          <p id="avgPrice" class="text-lg text-gray-600"></p>
        </div>

        <div class="relative h-[400px]">
          <canvas id="priceChart"></canvas>
        </div>
      </div>
    </main>

    <!-- ✅ SCRIPT -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Dropdown Functionality
      const featuresBtn = document.getElementById("featuresBtn");
      const featuresMenu = document.getElementById("featuresMenu");
      const languageBtn = document.getElementById("languageBtn");
      const languageMenu = document.getElementById("languageMenu");

      featuresBtn.addEventListener("click", () =>
        featuresMenu.classList.toggle("hidden")
      );
      languageBtn.addEventListener("click", () =>
        languageMenu.classList.toggle("hidden")
      );

      const form = document.getElementById("predictionForm");
      const resultDiv = document.getElementById("result");
      const priceRange = document.getElementById("priceRange");
      const avgPrice = document.getElementById("avgPrice");
      const ctx = document.getElementById("priceChart").getContext("2d");

      const priceChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: [],
          datasets: [
            {
              label: "Highest Price (₹)",
              data: [],
              backgroundColor: "rgba(34,197,94,0.8)",
              borderRadius: 6,
            },
            {
              label: "Lowest Price (₹)",
              data: [],
              backgroundColor: "rgba(132,204,22,0.6)",
              borderRadius: 6,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { grid: { display: false } },
            y: { grid: { display: false }, beginAtZero: true },
          },
          plugins: {
            legend: { display: true, position: "top" },
            tooltip: {
              callbacks: {
                label: (ctx) => `₹ ${ctx.parsed.y.toFixed(2)}`,
              },
            },
          },
          animation: {
            duration: 1000,
            easing: "easeInOutQuart",
          },
        },
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const crop = document.getElementById("crop").value;
        const month = document.getElementById("month").value;
        const year = document.getElementById("year").value;
        const rainfall = document.getElementById("rainfall").value;

        const response = await fetch("/predict-price", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ crop, month, year, rainfall }),
        });

        const data = await response.json();
        if (data.error) return alert(data.error);

        // Show results
        resultDiv.classList.remove("hidden");
        priceRange.textContent = `Price Range: ₹${data.min_price} - ₹${data.max_price}`;
        avgPrice.textContent = `Average Price: ₹${data.avg_price}`;

        // Update graph
        const labels = data.graph_data.map((d) => `M${d.month}`);
        const highs = data.graph_data.map((d) => d.max_price);
        const lows = data.graph_data.map((d) => d.min_price);

        priceChart.data.labels = labels;
        priceChart.data.datasets[0].data = highs;
        priceChart.data.datasets[1].data = lows;
        priceChart.update();
      });
    </script>
  </body>
</html>
